{"ast":null,"code":"var _jsxFileName = \"/Users/elvir/frontend/world-of-craft/src/contexts/CurrentUserContext.js\";\n// Custom context file to store all the logic to do with our context, \n// such as the current user state and making the API call when the components mount.\n\nimport React, { createContext, useContext, useEffect, useMemo, useState } from 'react';\nimport axios from 'axios';\nimport { axiosRes } from \"../api/axiosDefault\";\nimport { useNavigate } from \"react-router-dom\";\nexport const CurrentUserContext = createContext();\nexport const SetCurrentUserContext = createContext();\nexport const useCurrentUser = () => useContext(CurrentUserContext);\nexport const useSetCurrentUser = () => useContext(SetCurrentUserContext);\nexport const CurrentUserProvider = ({\n  children\n}) => {\n  const [currentUser, setCurrentUser] = useState(null);\n  const navigate = useNavigate();\n  const handleMount = async () => {\n    try {\n      const {\n        data\n      } = await axiosRes.get('dj-rest-auth/user/');\n      setCurrentUser(data);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n  useEffect(() => {\n    handleMount();\n  }, []);\n  useMemo(() => {\n    axiosRes.interceptors.response.use(response => response, async err => {\n      var _err$response;\n      if (((_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.status) === 401) {\n        try {\n          await axios.post('/dj-rest-auth/token/refresh/');\n        } catch (err) {\n          setCurrentUser(prevCurrentUser => {\n            if (prevCurrentUser) {\n              navigate('/signin');\n            }\n            return null;\n          });\n        }\n        return axios(err.config);\n      }\n      return Promise.reject(err);\n    });\n  });\n  return /*#__PURE__*/React.createElement(CurrentUserContext.Provider, {\n    value: currentUser,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 56,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(SetCurrentUserContext.Provider, {\n    value: setCurrentUser,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 57,\n      columnNumber: 13\n    }\n  }, children));\n};","map":{"version":3,"names":["React","createContext","useContext","useEffect","useMemo","useState","axios","axiosRes","useNavigate","CurrentUserContext","SetCurrentUserContext","useCurrentUser","useSetCurrentUser","CurrentUserProvider","children","currentUser","setCurrentUser","navigate","handleMount","data","get","err","console","log","interceptors","response","use","_err$response","status","post","prevCurrentUser","config","Promise","reject","createElement","Provider","value","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber"],"sources":["/Users/elvir/frontend/world-of-craft/src/contexts/CurrentUserContext.js"],"sourcesContent":["// Custom context file to store all the logic to do with our context, \n// such as the current user state and making the API call when the components mount.\n\nimport React, { createContext, useContext, useEffect, useMemo, useState } from 'react';\nimport axios from 'axios';\nimport { axiosRes } from \"../api/axiosDefault\";\nimport { useNavigate } from \"react-router-dom\";\n\nexport const CurrentUserContext = createContext()\nexport const SetCurrentUserContext = createContext()\n\nexport const useCurrentUser = () => useContext(CurrentUserContext)\nexport const useSetCurrentUser = () => useContext(SetCurrentUserContext)\n\nexport const CurrentUserProvider = ({ children }) => {\n    const [currentUser, setCurrentUser] = useState(null);\n    const navigate = useNavigate()\n\n    const handleMount = async () => {\n        try {\n            const { data } = await axiosRes.get('dj-rest-auth/user/')\n            setCurrentUser(data)\n        } catch (err) {\n            console.log(err)\n        }\n    }\n\n    useEffect(() => {\n        handleMount()\n    }, []);\n\n    useMemo(() => {\n        axiosRes.interceptors.response.use(\n            (response) => response,\n            async (err) => {\n                if (err.response?.status === 401) {\n                    try {\n                        await axios.post('/dj-rest-auth/token/refresh/')\n                    } catch (err) {\n                        setCurrentUser(prevCurrentUser => {\n                            if (prevCurrentUser) {\n                                navigate('/signin')\n                            }\n                            return null\n                        })\n\n                    }\n                    return axios(err.config)\n                }\n                return Promise.reject(err)\n            }\n        )\n    })\n\n    return (\n        <CurrentUserContext.Provider value={currentUser}>\n            <SetCurrentUserContext.Provider value={setCurrentUser}>\n                {children}\n            </SetCurrentUserContext.Provider>\n        </CurrentUserContext.Provider>\n    )\n}\n"],"mappings":";AAAA;AACA;;AAEA,OAAOA,KAAK,IAAIC,aAAa,EAAEC,UAAU,EAAEC,SAAS,EAAEC,OAAO,EAAEC,QAAQ,QAAQ,OAAO;AACtF,OAAOC,KAAK,MAAM,OAAO;AACzB,SAASC,QAAQ,QAAQ,qBAAqB;AAC9C,SAASC,WAAW,QAAQ,kBAAkB;AAE9C,OAAO,MAAMC,kBAAkB,GAAGR,aAAa,CAAC,CAAC;AACjD,OAAO,MAAMS,qBAAqB,GAAGT,aAAa,CAAC,CAAC;AAEpD,OAAO,MAAMU,cAAc,GAAGA,CAAA,KAAMT,UAAU,CAACO,kBAAkB,CAAC;AAClE,OAAO,MAAMG,iBAAiB,GAAGA,CAAA,KAAMV,UAAU,CAACQ,qBAAqB,CAAC;AAExE,OAAO,MAAMG,mBAAmB,GAAGA,CAAC;EAAEC;AAAS,CAAC,KAAK;EACjD,MAAM,CAACC,WAAW,EAAEC,cAAc,CAAC,GAAGX,QAAQ,CAAC,IAAI,CAAC;EACpD,MAAMY,QAAQ,GAAGT,WAAW,CAAC,CAAC;EAE9B,MAAMU,WAAW,GAAG,MAAAA,CAAA,KAAY;IAC5B,IAAI;MACA,MAAM;QAAEC;MAAK,CAAC,GAAG,MAAMZ,QAAQ,CAACa,GAAG,CAAC,oBAAoB,CAAC;MACzDJ,cAAc,CAACG,IAAI,CAAC;IACxB,CAAC,CAAC,OAAOE,GAAG,EAAE;MACVC,OAAO,CAACC,GAAG,CAACF,GAAG,CAAC;IACpB;EACJ,CAAC;EAEDlB,SAAS,CAAC,MAAM;IACZe,WAAW,CAAC,CAAC;EACjB,CAAC,EAAE,EAAE,CAAC;EAENd,OAAO,CAAC,MAAM;IACVG,QAAQ,CAACiB,YAAY,CAACC,QAAQ,CAACC,GAAG,CAC7BD,QAAQ,IAAKA,QAAQ,EACtB,MAAOJ,GAAG,IAAK;MAAA,IAAAM,aAAA;MACX,IAAI,EAAAA,aAAA,GAAAN,GAAG,CAACI,QAAQ,cAAAE,aAAA,uBAAZA,aAAA,CAAcC,MAAM,MAAK,GAAG,EAAE;QAC9B,IAAI;UACA,MAAMtB,KAAK,CAACuB,IAAI,CAAC,8BAA8B,CAAC;QACpD,CAAC,CAAC,OAAOR,GAAG,EAAE;UACVL,cAAc,CAACc,eAAe,IAAI;YAC9B,IAAIA,eAAe,EAAE;cACjBb,QAAQ,CAAC,SAAS,CAAC;YACvB;YACA,OAAO,IAAI;UACf,CAAC,CAAC;QAEN;QACA,OAAOX,KAAK,CAACe,GAAG,CAACU,MAAM,CAAC;MAC5B;MACA,OAAOC,OAAO,CAACC,MAAM,CAACZ,GAAG,CAAC;IAC9B,CACJ,CAAC;EACL,CAAC,CAAC;EAEF,oBACIrB,KAAA,CAAAkC,aAAA,CAACzB,kBAAkB,CAAC0B,QAAQ;IAACC,KAAK,EAAErB,WAAY;IAAAsB,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,gBAC5C1C,KAAA,CAAAkC,aAAA,CAACxB,qBAAqB,CAACyB,QAAQ;IAACC,KAAK,EAAEpB,cAAe;IAAAqB,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,GACjD5B,QAC2B,CACP,CAAC;AAEtC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module"}