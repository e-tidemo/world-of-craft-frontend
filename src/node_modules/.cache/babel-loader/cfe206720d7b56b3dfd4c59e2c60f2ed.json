{"ast":null,"code":"var _jsxFileName = \"/Users/elvir/frontend/world-of-craft/src/contexts/CurrentUserContext.js\";\n// Custom context file to store all the logic to do with our context, \n// such as the current user state and making the API call when the components mount.\n\nimport React, { createContext, useContext, useEffect, useMemo, useState } from 'react';\nimport axios from 'axios';\nimport { axiosReq, axiosRes } from \"../api/axiosDefault\";\nimport { useHistory } from \"react-router-dom\";\nexport const CurrentUserContext = createContext();\nexport const SetCurrentUserContext = createContext();\nexport const useCurrentUser = () => useContext(CurrentUserContext);\nexport const useSetCurrentUser = () => useContext(SetCurrentUserContext);\nexport const CurrentUserProvider = ({\n  children\n}) => {\n  const [currentUser, setCurrentUser] = useState(null);\n  const history = useHistory();\n  const handleMount = async () => {\n    try {\n      const {\n        data\n      } = await axiosRes.get(`dj-rest-auth/user/`);\n      setCurrentUser(data);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n  useEffect(() => {\n    handleMount();\n  }, []);\n  useMemo(() => {\n    axiosReq.interceptors.request.use(async config => {\n      try {\n        await axios.post(`/dj-rest-auth/token/refresh/`);\n      } catch (err) {\n        setCurrentUser(prevCurrentUser => {\n          if (prevCurrentUser) {\n            history.push('/signin');\n          }\n          return null;\n        });\n        return config;\n      }\n      return config;\n    }, err => {\n      return Promise.reject(err);\n    });\n    axiosRes.interceptors.response.use(response => response, async err => {\n      var _err$response;\n      if (((_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.status) === 401) {\n        try {\n          await axios.post(`/dj-rest-auth/token/refresh/`);\n        } catch (err) {\n          setCurrentUser(prevCurrentUser => {\n            if (prevCurrentUser) {\n              navigate('/signin');\n            }\n            return null;\n          });\n        }\n        return axios(err.config);\n      }\n      return Promise.reject(err);\n    });\n  }, [navigate]);\n  return /*#__PURE__*/React.createElement(CurrentUserContext.Provider, {\n    value: currentUser,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(SetCurrentUserContext.Provider, {\n    value: setCurrentUser,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 13\n    }\n  }, children));\n};","map":{"version":3,"names":["React","createContext","useContext","useEffect","useMemo","useState","axios","axiosReq","axiosRes","useHistory","CurrentUserContext","SetCurrentUserContext","useCurrentUser","useSetCurrentUser","CurrentUserProvider","children","currentUser","setCurrentUser","history","handleMount","data","get","err","console","log","interceptors","request","use","config","post","prevCurrentUser","push","Promise","reject","response","_err$response","status","navigate","createElement","Provider","value","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber"],"sources":["/Users/elvir/frontend/world-of-craft/src/contexts/CurrentUserContext.js"],"sourcesContent":["// Custom context file to store all the logic to do with our context, \n// such as the current user state and making the API call when the components mount.\n\nimport React, { createContext, useContext, useEffect, useMemo, useState } from 'react';\nimport axios from 'axios';\nimport { axiosReq, axiosRes } from \"../api/axiosDefault\";\nimport { useHistory } from \"react-router-dom\";\n\nexport const CurrentUserContext = createContext()\nexport const SetCurrentUserContext = createContext()\n\nexport const useCurrentUser = () => useContext(CurrentUserContext)\nexport const useSetCurrentUser = () => useContext(SetCurrentUserContext)\n\nexport const CurrentUserProvider = ({ children }) => {\n    const [currentUser, setCurrentUser] = useState(null);\n    const history = useHistory()\n\n    const handleMount = async () => {\n        try {\n            const { data } = await axiosRes.get(`dj-rest-auth/user/`)\n            setCurrentUser(data)\n        } catch (err) {\n            console.log(err)\n        }\n    }\n\n    useEffect(() => {\n        handleMount()\n    }, []);\n\n    useMemo(() => {\n        axiosReq.interceptors.request.use(\n            async (config) => {\n                try {\n                    await axios.post(`/dj-rest-auth/token/refresh/`)\n                } catch(err){\n                    setCurrentUser((prevCurrentUser) => {\n                        if (prevCurrentUser) {\n                            history.push('/signin')\n                        }\n                        return null;\n                    })\n                    return config;\n                }\n                return config;\n            },\n            (err) => {\n                return Promise.reject(err);\n            }\n        );\n        axiosRes.interceptors.response.use(\n            (response) => response,\n            async (err) => {\n                if (err.response?.status === 401) {\n                    try {\n                        await axios.post(`/dj-rest-auth/token/refresh/`)\n                    } catch (err) {\n                        setCurrentUser(prevCurrentUser => {\n                            if (prevCurrentUser) {\n                                navigate('/signin')\n                            }\n                            return null\n                        })\n\n                    }\n                    return axios(err.config)\n                }\n                return Promise.reject(err)\n            }\n        )\n    }, [navigate]);\n\n    return (\n        <CurrentUserContext.Provider value={currentUser}>\n            <SetCurrentUserContext.Provider value={setCurrentUser}>\n                {children}\n            </SetCurrentUserContext.Provider>\n        </CurrentUserContext.Provider>\n    )\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}